<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | ResumeReader</title>
    <link rel="stylesheet" href="login.css">
</head>
<body>

<div class="container">
    <div class="left-box">
        <img src="image/logo.jpg" class="logo">
    </div>

    <div class="right-box">
        <h1>Login</h1>

        <form action="login.php" method="POST">
            <label>Email</label>
            <input type="email" name="email" placeholder="Email" required>

            <label>Password</label>
            <input type="password" name="password" required>

            <a href="#" class="forgot" onclick="openEmailModal()">Forgot Password?</a>

            <button type="submit" class="login-btn">Login</button>
        </form>

        <p class="register-text">Donâ€™t have an account? 
            <a href="register.php">Register here</a>
        </p>

        <footer>Copyright 2025 | ResumeReader</footer>
    </div>
</div>

<!-- âšª STEP 1 â€” Enter Email -->
<div id="emailModal" class="modal">
    <div class="modal-content">
        <h3>Forgot Password</h3>

        <label>Email</label>
        <input type="email" id="fpEmail" placeholder="Enter your email">

        <button onclick="sendCode()" class="confirm-btn">Confirm</button>
        <button onclick="closeEmailModal()" class="cancel-btn">Cancel</button>
    </div>
</div>

<!-- ðŸŸ¡ STEP 2 â€” Enter Verification Code -->
<div id="codeModal" class="modal">
    <div class="modal-content">
        <h3>Verification Code</h3>

        <p id="emailDisplay"></p>

        <label>Verification Code</label>
        <input type="text" id="verifyCode">

        <button onclick="checkCode()" class="confirm-btn">Confirm</button>
        <button onclick="closeCodeModal()" class="cancel-btn">Cancel</button>
        <a href="#" onclick="resendCode()" class="resend-link">Resend Code</a>
    </div>
</div>

<!-- ðŸŸ¢ STEP 3 â€” Update Password -->
<div id="updateModal" class="modal">
    <div class="modal-content">
        <h3>Update New Password</h3>

        <label>New Password</label>
        <input type="password" id="newPassword">

        <label>Confirm New Password</label>
        <input type="password" id="confirmPassword">

        <button onclick="updatePassword()" class="confirm-btn">Confirm</button>
        <button onclick="closeUpdateModal()" class="cancel-btn">Cancel</button>
    </div>
</div>


<script>
let sentCode = "";
let currentEmail = "";

function openEmailModal() {
    document.getElementById("emailModal").style.display = "flex";
}

function closeEmailModal() {
    document.getElementById("emailModal").style.display = "none";
}

function sendCode() {
    currentEmail = document.getElementById("fpEmail").value;

    if (currentEmail.trim() === "") {
        alert("Please enter your email.");
        return;
    }

    // Generate 6-digit code
    sentCode = Math.floor(100000 + Math.random() * 900000);

    sessionStorage.setItem("code", sentCode);
    sessionStorage.setItem("email", currentEmail);

    document.getElementById("emailDisplay").innerHTML = 
        "A verification code has been sent to <b>" + currentEmail + "</b>";

    closeEmailModal();
    document.getElementById("codeModal").style.display = "flex";
}

function checkCode() {
    let userCode = document.getElementById("verifyCode").value;
    let correctCode = sessionStorage.getItem("code");

    if (userCode !== correctCode) {
        alert("Incorrect verification code!");
        return;
    }

    closeCodeModal();
    document.getElementById("updateModal").style.display = "flex";
}

function closeCodeModal() {
    document.getElementById("codeModal").style.display = "none";
}

function resendCode() {
    sendCode();
    alert("A new code has been sent.");
}

function updatePassword() {
    let pass1 = document.getElementById("newPassword").value;
    let pass2 = document.getElementById("confirmPassword").value;

    if (pass1 !== pass2) {
        alert("Passwords do not match!");
        return;
    }

    // Send to PHP to update DB
    fetch("update_password.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `email=${currentEmail}&password=${pass1}`
    })
    .then(res => res.text())
    .then(data => {
        alert(data);
        window.location.href = "login.html";
    });
}

function closeUpdateModal() {
    document.getElementById("updateModal").style.display = "none";
}
</script>

</body>
</html>
